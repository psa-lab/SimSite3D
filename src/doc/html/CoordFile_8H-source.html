<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>simsite3d: CoordFile.H Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
  </ul></div>
<h1>CoordFile.H</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/******************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment"> * Copyright (c) 2006,2007, Michigan State University (MSU) Board of Trustees.</span>
<a name="l00003"></a>00003 <span class="comment"> *   All rights reserved.</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> * This file is part of the SimSite3D Software project.</span>
<a name="l00006"></a>00006 <span class="comment"> *</span>
<a name="l00007"></a>00007 <span class="comment"> * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<a name="l00008"></a>00008 <span class="comment"> * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<a name="l00009"></a>00009 <span class="comment"> * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<a name="l00010"></a>00010 <span class="comment"> * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<a name="l00011"></a>00011 <span class="comment"> * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<a name="l00012"></a>00012 <span class="comment"> * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<a name="l00013"></a>00013 <span class="comment"> * THE SOFTWARE.</span>
<a name="l00014"></a>00014 <span class="comment"> *</span>
<a name="l00015"></a>00015 <span class="comment"> * Authors: Jeffrey Van Voorst, vanvoor4@msu.edu</span>
<a name="l00016"></a>00016 <span class="comment"> *          Leslie Kuhn, Ph.D., KuhnL@msu.edu </span>
<a name="l00017"></a>00017 <span class="comment"> *****************************************************************************/</span>
<a name="l00018"></a>00018 
<a name="l00019"></a>00019 <span class="preprocessor">#ifndef COORD_FILE_HEADER_INCLUDED</span>
<a name="l00020"></a>00020 <span class="preprocessor"></span><span class="preprocessor">#define COORD_FILE_HEADER_INCLUDED</span>
<a name="l00021"></a>00021 <span class="preprocessor"></span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &lt;basics.H&gt;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;atom.H&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;PDB_metals.H&gt;</span>
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="keyword">namespace </span>SimSite3D{
<a name="l00027"></a>00027   
<a name="l00028"></a>00028   <span class="keyword">class </span>CoordFile;
<a name="l00029"></a>00029 
<a name="l00030"></a>00030   <span class="keyword">inline</span> my_float_t simple_rmsd(<span class="keyword">const</span> CoordFile&amp; f1, <span class="keyword">const</span> CoordFile&amp; f2);
<a name="l00031"></a>00031 
<a name="l00035"></a>00035 
<a name="l00040"></a><a class="code" href="classSimSite3D_1_1CoordFile.html">00040</a>   <span class="keyword">class </span><a class="code" href="classSimSite3D_1_1CoordFile.html">CoordFile</a>{
<a name="l00041"></a>00041   <span class="keyword">public</span>:
<a name="l00042"></a>00042     <span class="keyword">friend</span> my_float_t <a class="code" href="classSimSite3D_1_1CoordFile.html#28b33c885437b5169dcd5d8700110bff">simple_rmsd</a>(<span class="keyword">const</span> <a class="code" href="classSimSite3D_1_1CoordFile.html">CoordFile</a>&amp; f1, <span class="keyword">const</span> <a class="code" href="classSimSite3D_1_1CoordFile.html">CoordFile</a>&amp; f2);
<a name="l00043"></a>00043 
<a name="l00045"></a>00045     <a class="code" href="classSimSite3D_1_1CoordFile.html#7e9fbda616d8d9141663ded676268a4f">CoordFile</a>();
<a name="l00046"></a>00046 
<a name="l00048"></a>00048 
<a name="l00052"></a>00052     <a class="code" href="classSimSite3D_1_1CoordFile.html#7e9fbda616d8d9141663ded676268a4f">CoordFile</a>(<span class="keyword">const</span> std::string filename_in, 
<a name="l00053"></a>00053               <span class="keyword">const</span> verbose_level_t verbosity = VERBOSE_SILENT);
<a name="l00054"></a>00054 
<a name="l00057"></a>00057     <a class="code" href="classSimSite3D_1_1CoordFile.html#7e9fbda616d8d9141663ded676268a4f">CoordFile</a>(<span class="keyword">const</span> <a class="code" href="classSimSite3D_1_1CoordFile.html">CoordFile</a>&amp; src);
<a name="l00058"></a>00058 
<a name="l00060"></a>00060     <span class="keyword">virtual</span> <a class="code" href="classSimSite3D_1_1CoordFile.html#b0646aae13c5714c541f9c0dfad334c7">~CoordFile</a>();
<a name="l00061"></a>00061 
<a name="l00063"></a>00063 
<a name="l00066"></a>00066     <span class="keyword">virtual</span> <span class="keywordtype">void</span> 
<a name="l00067"></a>00067     <a class="code" href="classSimSite3D_1_1CoordFile.html#a2153c9f750dd76c3b533f9e03bd8f05">report_stats</a>(std::ostream&amp; out) = 0;
<a name="l00068"></a>00068   
<a name="l00070"></a>00070 
<a name="l00073"></a>00073     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> 
<a name="l00074"></a>00074     <a class="code" href="classSimSite3D_1_1CoordFile.html#dca3f5f45c21f85215dc380e2152b613">write</a>(<span class="keyword">const</span> std::string filename) = 0;
<a name="l00075"></a>00075  
<a name="l00076"></a>00076     <span class="comment">// Someday may want to look at writing iterators the "correct" way</span>
<a name="l00077"></a>00077     <span class="comment">// Need to setup the arrays</span>
<a name="l00078"></a>00078     atom_vci 
<a name="l00079"></a>00079     atoms_begin()<span class="keyword"> const </span>
<a name="l00080"></a>00080 <span class="keyword">    </span>{ <span class="keywordflow">return</span> <a class="code" href="classSimSite3D_1_1CoordFile.html#e6fd931154c7b8e59298b58f592f7799">atoms</a>.begin(); }
<a name="l00081"></a>00081 
<a name="l00082"></a>00082     atom_vci 
<a name="l00083"></a>00083     atoms_end()<span class="keyword"> const</span>
<a name="l00084"></a>00084 <span class="keyword">    </span>{ <span class="keywordflow">return</span> <a class="code" href="classSimSite3D_1_1CoordFile.html#e6fd931154c7b8e59298b58f592f7799">atoms</a>.end(); }
<a name="l00085"></a>00085 
<a name="l00086"></a>00086     <span class="keyword">const</span> my_float_t*
<a name="l00087"></a>00087     positions_begin()<span class="keyword"> const</span>
<a name="l00088"></a>00088 <span class="keyword">    </span>{ <span class="keywordflow">return</span> <a class="code" href="classSimSite3D_1_1CoordFile.html#e6fd931154c7b8e59298b58f592f7799">atoms</a>.points_begin(); }
<a name="l00089"></a>00089 
<a name="l00090"></a>00090     <span class="keyword">const</span> my_float_t*
<a name="l00091"></a>00091     positions_end()<span class="keyword"> const</span>
<a name="l00092"></a>00092 <span class="keyword">    </span>{ <span class="keywordflow">return</span> <a class="code" href="classSimSite3D_1_1CoordFile.html#e6fd931154c7b8e59298b58f592f7799">atoms</a>.points_end(); }
<a name="l00093"></a>00093 
<a name="l00095"></a>00095     atom_vci 
<a name="l00096"></a><a class="code" href="classSimSite3D_1_1CoordFile.html#c9649e85ff13ba1997fc8809401733d3">00096</a>     <a class="code" href="classSimSite3D_1_1CoordFile.html#c9649e85ff13ba1997fc8809401733d3">get_atom</a>(<span class="keyword">const</span> uint atom_num)
<a name="l00097"></a>00097     { 
<a name="l00098"></a>00098       <span class="keywordflow">if</span>(<a class="code" href="classSimSite3D_1_1CoordFile.html#e6fd931154c7b8e59298b58f592f7799">atoms</a>.size() &gt; <a class="code" href="classSimSite3D_1_1CoordFile.html#4080cb23aeba4b34ac77e37dcc6d9f0c">atoms_by_num</a>.size()) update_atoms_by_num();
<a name="l00099"></a>00099       atom_map_t::const_iterator iter = <a class="code" href="classSimSite3D_1_1CoordFile.html#4080cb23aeba4b34ac77e37dcc6d9f0c">atoms_by_num</a>.find(atom_num);
<a name="l00100"></a>00100       <span class="keywordflow">if</span>(iter != <a class="code" href="classSimSite3D_1_1CoordFile.html#4080cb23aeba4b34ac77e37dcc6d9f0c">atoms_by_num</a>.end()) <span class="keywordflow">return</span> iter-&gt;second;
<a name="l00101"></a>00101       <span class="keywordflow">else</span> <span class="keywordflow">return</span> <a class="code" href="classSimSite3D_1_1atom__t.html#6006207a0eed1857af230dca1dadc4a1">atom_t::NULL_ATOM_VCI</a>;
<a name="l00102"></a>00102     }
<a name="l00103"></a>00103 
<a name="l00104"></a>00104 
<a name="l00106"></a>00106     <span class="keywordtype">bool</span> 
<a name="l00107"></a><a class="code" href="classSimSite3D_1_1CoordFile.html#62b4ac1cdf4bae7acb19ce63bfca599d">00107</a>     <a class="code" href="classSimSite3D_1_1CoordFile.html#62b4ac1cdf4bae7acb19ce63bfca599d">fail</a>()<span class="keyword"> const </span>
<a name="l00108"></a>00108 <span class="keyword">    </span>{ <span class="keywordflow">return</span> <a class="code" href="classSimSite3D_1_1CoordFile.html#0b784057f780e3960b89ed6f8a25adff">A_fail</a>; }
<a name="l00109"></a>00109 
<a name="l00111"></a>00111     std::string 
<a name="l00112"></a><a class="code" href="classSimSite3D_1_1CoordFile.html#687a29cf9f287acaa3919c7cd11a1474">00112</a>     <a class="code" href="classSimSite3D_1_1CoordFile.html#687a29cf9f287acaa3919c7cd11a1474">name</a>()<span class="keyword"> const </span>
<a name="l00113"></a>00113 <span class="keyword">    </span>{ <span class="keywordflow">return</span> <a class="code" href="classSimSite3D_1_1CoordFile.html#75d613311625154ae2d08009fcfa29b2">name_of_file</a>; }
<a name="l00114"></a>00114 
<a name="l00116"></a>00116     <span class="keywordtype">void</span>
<a name="l00117"></a><a class="code" href="classSimSite3D_1_1CoordFile.html#e288ddf8441fe4652e6a1b90a4b5198c">00117</a>     <a class="code" href="classSimSite3D_1_1CoordFile.html#e288ddf8441fe4652e6a1b90a4b5198c">transform</a>(<span class="keyword">const</span> my_float_t* R, <span class="keyword">const</span> my_float_t* T)
<a name="l00118"></a>00118     { <a class="code" href="classSimSite3D_1_1CoordFile.html#e6fd931154c7b8e59298b58f592f7799">atoms</a>.transform(R,T); }
<a name="l00119"></a>00119 
<a name="l00121"></a>00121     <span class="keywordtype">void</span>
<a name="l00122"></a><a class="code" href="classSimSite3D_1_1CoordFile.html#379c544ae1cd926491619e0f46532e27">00122</a>     <a class="code" href="classSimSite3D_1_1CoordFile.html#379c544ae1cd926491619e0f46532e27">inverse_transform</a>(<span class="keyword">const</span> my_float_t* R, <span class="keyword">const</span> my_float_t* T)
<a name="l00123"></a>00123     { <a class="code" href="classSimSite3D_1_1CoordFile.html#e6fd931154c7b8e59298b58f592f7799">atoms</a>.inverse_transform(R,T); }
<a name="l00124"></a>00124 
<a name="l00126"></a>00126     <span class="keywordtype">void</span>
<a name="l00127"></a><a class="code" href="classSimSite3D_1_1CoordFile.html#6f632e32959f743ccc307a16e04c1a96">00127</a>     <a class="code" href="classSimSite3D_1_1CoordFile.html#6f632e32959f743ccc307a16e04c1a96">revert</a>() 
<a name="l00128"></a>00128     { <a class="code" href="classSimSite3D_1_1CoordFile.html#e6fd931154c7b8e59298b58f592f7799">atoms</a>.revert(); }
<a name="l00129"></a>00129 
<a name="l00130"></a>00130     <span class="keywordtype">void</span>
<a name="l00131"></a>00131     bin_coordinates(<span class="keyword">const</span> my_float_t max_dist)
<a name="l00132"></a>00132     { <a class="code" href="classSimSite3D_1_1CoordFile.html#e6fd931154c7b8e59298b58f592f7799">atoms</a>.bin_points(max_dist); }
<a name="l00133"></a>00133 
<a name="l00135"></a>00135     atom_vci
<a name="l00136"></a><a class="code" href="classSimSite3D_1_1CoordFile.html#7727bbdac08565a2a01edad154108a49">00136</a>     <a class="code" href="classSimSite3D_1_1CoordFile.html#7727bbdac08565a2a01edad154108a49">closest_atom</a>(<span class="keyword">const</span> my_float_t* pos, my_float_t* d)<span class="keyword"> const</span>
<a name="l00137"></a>00137 <span class="keyword">    </span>{ <span class="keywordflow">return</span> <a class="code" href="classSimSite3D_1_1CoordFile.html#e6fd931154c7b8e59298b58f592f7799">atoms</a>.closest_point(pos, d); }
<a name="l00138"></a>00138 
<a name="l00140"></a>00140     <span class="keywordtype">void</span>
<a name="l00141"></a><a class="code" href="classSimSite3D_1_1CoordFile.html#b6942055ebe927bfbedecc8f0fe098af">00141</a>     <a class="code" href="classSimSite3D_1_1CoordFile.html#b6942055ebe927bfbedecc8f0fe098af">close_atoms</a>(<span class="keyword">const</span> my_float_t *pos, <span class="keyword">const</span> my_float_t radius,
<a name="l00142"></a>00142                 std::multimap&lt;my_float_t, atom_vci&gt;* pts_map) <span class="keyword">const</span>
<a name="l00143"></a>00143                 <span class="comment">//float_const_iter_map* pts_map) const</span>
<a name="l00144"></a>00144     { <a class="code" href="classSimSite3D_1_1CoordFile.html#e6fd931154c7b8e59298b58f592f7799">atoms</a>.close_points(pos, radius, pts_map); }
<a name="l00145"></a>00145 
<a name="l00148"></a>00148 
<a name="l00152"></a>00152     <span class="keyword">const</span> <span class="keywordtype">bool</span>
<a name="l00153"></a><a class="code" href="classSimSite3D_1_1CoordFile.html#8c96db0c2e04610ffbe1e1dd5ad57ee9">00153</a>     <a class="code" href="classSimSite3D_1_1CoordFile.html#8c96db0c2e04610ffbe1e1dd5ad57ee9">overlapping_atoms</a>(<span class="keyword">const</span> <a class="code" href="classSimSite3D_1_1atom__t.html">atom_t</a>&amp; a)<span class="keyword"> const</span>
<a name="l00154"></a>00154 <span class="keyword">    </span>{
<a name="l00155"></a>00155       <span class="keywordflow">for</span>(atom_vci b = <a class="code" href="classSimSite3D_1_1CoordFile.html#e6fd931154c7b8e59298b58f592f7799">atoms</a>.begin(); b != <a class="code" href="classSimSite3D_1_1CoordFile.html#e6fd931154c7b8e59298b58f592f7799">atoms</a>.end(); ++b)
<a name="l00156"></a>00156         <span class="keywordflow">if</span>(<a class="code" href="classSimSite3D_1_1CoordFile.html#db5f1f82c8b7cb06fe1dd131ca8d67ca">atoms_overlap</a>(a, *b)) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00157"></a>00157       <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00158"></a>00158     }
<a name="l00159"></a>00159   
<a name="l00161"></a>00161 
<a name="l00170"></a>00170     <span class="keywordtype">bool</span>
<a name="l00171"></a><a class="code" href="classSimSite3D_1_1CoordFile.html#2cfb5884b1f35cd24743e7c76dfaa155">00171</a>     <a class="code" href="classSimSite3D_1_1CoordFile.html#8c96db0c2e04610ffbe1e1dd5ad57ee9">overlapping_atoms</a>(<span class="keyword">const</span> <a class="code" href="classSimSite3D_1_1atom__t.html">atom_t</a>&amp; a, std::vector&lt;atom_vci&gt;* overlaps)
<a name="l00172"></a>00172     {
<a name="l00173"></a>00173       overlaps-&gt;clear();
<a name="l00174"></a>00174       <span class="keywordflow">for</span>(atom_vci b = <a class="code" href="classSimSite3D_1_1CoordFile.html#e6fd931154c7b8e59298b58f592f7799">atoms</a>.begin(); b != <a class="code" href="classSimSite3D_1_1CoordFile.html#e6fd931154c7b8e59298b58f592f7799">atoms</a>.end(); ++b)
<a name="l00175"></a>00175         <span class="keywordflow">if</span>(<a class="code" href="classSimSite3D_1_1CoordFile.html#db5f1f82c8b7cb06fe1dd131ca8d67ca">atoms_overlap</a>(a, *b)) overlaps-&gt;push_back(b);
<a name="l00176"></a>00176       <span class="keywordflow">return</span> (overlaps-&gt;size() ? <span class="keyword">true</span> : <span class="keyword">false</span>);
<a name="l00177"></a>00177     }
<a name="l00178"></a>00178 
<a name="l00180"></a>00180     <span class="keyword">const</span> uint
<a name="l00181"></a><a class="code" href="classSimSite3D_1_1CoordFile.html#acec4ad5461784995b4fb15bb97e34d4">00181</a>     <a class="code" href="classSimSite3D_1_1CoordFile.html#acec4ad5461784995b4fb15bb97e34d4">num_atoms</a>()<span class="keyword"> const</span>
<a name="l00182"></a>00182 <span class="keyword">    </span>{ <span class="keywordflow">return</span> <a class="code" href="classSimSite3D_1_1CoordFile.html#e6fd931154c7b8e59298b58f592f7799">atoms</a>.size(); }
<a name="l00183"></a>00183 
<a name="l00185"></a>00185     <span class="keyword">const</span> <span class="keywordtype">bool</span>
<a name="l00186"></a><a class="code" href="classSimSite3D_1_1CoordFile.html#db452cab2816a058a7767b0d1792e4eb">00186</a>     <a class="code" href="classSimSite3D_1_1CoordFile.html#db452cab2816a058a7767b0d1792e4eb">centroid_3D</a>(my_float_t* C)<span class="keyword"> const</span>
<a name="l00187"></a>00187 <span class="keyword">    </span>{ <span class="keywordflow">return</span> <a class="code" href="classSimSite3D_1_1CoordFile.html#e6fd931154c7b8e59298b58f592f7799">atoms</a>.centroid_3D(C); }
<a name="l00188"></a>00188 
<a name="l00189"></a>00189     <span class="keyword">inline</span> <span class="keywordtype">void</span>
<a name="l00190"></a>00190     get_atom_bin(atom_vci a, <a class="code" href="classSimSite3D_1_1point__storage.html">point_storage&lt;atom_t&gt;::bins_vci_type</a> *nbrs, 
<a name="l00191"></a>00191                  <a class="code" href="classSimSite3D_1_1point__storage.html">point_storage&lt;atom_t&gt;::bins_vci_type</a> *moved_nbrs)<span class="keyword"> const</span>
<a name="l00192"></a>00192 <span class="keyword">    </span>{ <span class="keywordflow">return</span> <a class="code" href="classSimSite3D_1_1CoordFile.html#e6fd931154c7b8e59298b58f592f7799">atoms</a>.get_bin(a-&gt;pos, nbrs, moved_nbrs); }
<a name="l00193"></a>00193 
<a name="l00194"></a>00194     <span class="keywordtype">void</span>
<a name="l00195"></a>00195     write_xyzr_line(std::ostream&amp; out, <span class="keyword">const</span> my_float_t* pos,
<a name="l00196"></a>00196                     <span class="keyword">const</span> my_float_t vdw_radius);
<a name="l00197"></a>00197 
<a name="l00198"></a>00198     <span class="keyword">inline</span> <span class="keywordtype">void</span>
<a name="l00199"></a>00199     write_bin_bounds(std::ostream &amp;out)<span class="keyword"> const</span>
<a name="l00200"></a>00200 <span class="keyword">    </span>{ <a class="code" href="classSimSite3D_1_1CoordFile.html#e6fd931154c7b8e59298b58f592f7799">atoms</a>.write_bin_bounds(out); }
<a name="l00201"></a>00201 
<a name="l00202"></a>00202   <span class="keyword">protected</span>:
<a name="l00204"></a>00204     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classSimSite3D_1_1CoordFile.html#1fdc54fd347269643062dee5418859a5">read_data</a>(std::ifstream &amp;fin) = 0;
<a name="l00205"></a>00205 
<a name="l00207"></a>00207     atom_vci 
<a name="l00208"></a><a class="code" href="classSimSite3D_1_1CoordFile.html#c420fb9bdfd343ab2ec4927449cbe75c">00208</a>     <a class="code" href="classSimSite3D_1_1CoordFile.html#c420fb9bdfd343ab2ec4927449cbe75c">append_atom</a>(<span class="keyword">const</span> <a class="code" href="classSimSite3D_1_1atom__t.html">atom_t</a>&amp; a)
<a name="l00209"></a>00209     { 
<a name="l00210"></a>00210       <a class="code" href="classSimSite3D_1_1CoordFile.html#e6fd931154c7b8e59298b58f592f7799">atoms</a>.push_back(a);
<a name="l00211"></a>00211       <span class="keywordflow">return</span> <a class="code" href="classSimSite3D_1_1CoordFile.html#e6fd931154c7b8e59298b58f592f7799">atoms</a>.end();
<a name="l00212"></a>00212     }
<a name="l00213"></a>00213 
<a name="l00216"></a>00216 
<a name="l00219"></a>00219     atom_vi 
<a name="l00220"></a><a class="code" href="classSimSite3D_1_1CoordFile.html#789e3d25f1bed7a0cf1ac6c2b31c7a1a">00220</a>     <a class="code" href="classSimSite3D_1_1CoordFile.html#789e3d25f1bed7a0cf1ac6c2b31c7a1a">atoms_storage_begin</a>()
<a name="l00221"></a>00221     { <span class="keywordflow">return</span> <a class="code" href="classSimSite3D_1_1CoordFile.html#e6fd931154c7b8e59298b58f592f7799">atoms</a>.begin(); }
<a name="l00222"></a>00222 
<a name="l00225"></a>00225     atom_vi 
<a name="l00226"></a><a class="code" href="classSimSite3D_1_1CoordFile.html#c3841ed3d35545b650f1be670c8bda08">00226</a>     <a class="code" href="classSimSite3D_1_1CoordFile.html#c3841ed3d35545b650f1be670c8bda08">atoms_storage_end</a>()
<a name="l00227"></a>00227     { <span class="keywordflow">return</span> <a class="code" href="classSimSite3D_1_1CoordFile.html#e6fd931154c7b8e59298b58f592f7799">atoms</a>.end(); }
<a name="l00228"></a>00228 
<a name="l00230"></a>00230     <span class="keywordtype">void</span> 
<a name="l00231"></a><a class="code" href="classSimSite3D_1_1CoordFile.html#a61fc09c8cd8b59f083cc888042b6845">00231</a>     <a class="code" href="classSimSite3D_1_1CoordFile.html#a61fc09c8cd8b59f083cc888042b6845">green_light</a>() 
<a name="l00232"></a>00232     { <a class="code" href="classSimSite3D_1_1CoordFile.html#0b784057f780e3960b89ed6f8a25adff">A_fail</a> = <span class="keyword">false</span>; }
<a name="l00233"></a>00233   
<a name="l00235"></a>00235     <span class="keywordtype">void</span> 
<a name="l00236"></a><a class="code" href="classSimSite3D_1_1CoordFile.html#042ec36f57b06cb0882fff7eae5c8018">00236</a>     <a class="code" href="classSimSite3D_1_1CoordFile.html#042ec36f57b06cb0882fff7eae5c8018">red_light</a>() 
<a name="l00237"></a>00237     { <a class="code" href="classSimSite3D_1_1CoordFile.html#0b784057f780e3960b89ed6f8a25adff">A_fail</a> = <span class="keyword">true</span>; }
<a name="l00238"></a>00238 
<a name="l00239"></a>00239   <span class="keyword">private</span>:
<a name="l00240"></a>00240 
<a name="l00241"></a>00241     <span class="keywordtype">void</span> update_atoms_by_num()
<a name="l00242"></a>00242     {
<a name="l00243"></a>00243       atom_vci a;
<a name="l00244"></a>00244       <span class="keywordflow">for</span>(a = <a class="code" href="classSimSite3D_1_1CoordFile.html#e6fd931154c7b8e59298b58f592f7799">atoms</a>.begin() + <a class="code" href="classSimSite3D_1_1CoordFile.html#4080cb23aeba4b34ac77e37dcc6d9f0c">atoms_by_num</a>.size(); a &lt; <a class="code" href="classSimSite3D_1_1CoordFile.html#e6fd931154c7b8e59298b58f592f7799">atoms</a>.end(); ++a)
<a name="l00245"></a>00245         <a class="code" href="classSimSite3D_1_1CoordFile.html#4080cb23aeba4b34ac77e37dcc6d9f0c">atoms_by_num</a>[a-&gt;atom_num] = a; 
<a name="l00246"></a>00246     }
<a name="l00247"></a>00247 
<a name="l00249"></a>00249 
<a name="l00258"></a>00258     <span class="keyword">const</span> <span class="keywordtype">bool</span> 
<a name="l00259"></a><a class="code" href="classSimSite3D_1_1CoordFile.html#db5f1f82c8b7cb06fe1dd131ca8d67ca">00259</a>     <a class="code" href="classSimSite3D_1_1CoordFile.html#db5f1f82c8b7cb06fe1dd131ca8d67ca">atoms_overlap</a>(<span class="keyword">const</span> <a class="code" href="classSimSite3D_1_1atom__t.html">atom_t</a>&amp; a, <span class="keyword">const</span> <a class="code" href="classSimSite3D_1_1atom__t.html">atom_t</a>&amp; b)<span class="keyword"> const </span>
<a name="l00260"></a>00260 <span class="keyword">    </span>{
<a name="l00261"></a>00261       <span class="comment">// The assumption is waters and metals shouldn't be in the protein unless</span>
<a name="l00262"></a>00262       <span class="comment">// they are to be considered as part of the binding site</span>
<a name="l00263"></a>00263       my_float_t dd = dist_squared(a.<a class="code" href="classSimSite3D_1_1point__t.html#f264a8131763764aa42e9413724d95ab">pos</a>, b.<a class="code" href="classSimSite3D_1_1point__t.html#f264a8131763764aa42e9413724d95ab">pos</a>);
<a name="l00264"></a>00264 
<a name="l00265"></a>00265       <span class="comment">// Complementary Hbonding atoms</span>
<a name="l00266"></a>00266       <span class="keywordflow">if</span>((a.<a class="code" href="classSimSite3D_1_1atom__t.html#0649f5881857d9437b85dfec852f5a88">act_type</a> == DONOR || a.<a class="code" href="classSimSite3D_1_1atom__t.html#0649f5881857d9437b85dfec852f5a88">act_type</a> == DONEPTOR) &amp;&amp; 
<a name="l00267"></a>00267          (b.<a class="code" href="classSimSite3D_1_1atom__t.html#0649f5881857d9437b85dfec852f5a88">act_type</a> == ACCEPTOR || b.<a class="code" href="classSimSite3D_1_1atom__t.html#0649f5881857d9437b85dfec852f5a88">act_type</a> == DONEPTOR)){
<a name="l00268"></a>00268         <span class="keywordflow">if</span>(dd &lt; <a class="code" href="classSimSite3D_1_1CoordFile.html#24508f2022eb61a82e256555d6149193">min_hbond_dist</a>*<a class="code" href="classSimSite3D_1_1CoordFile.html#24508f2022eb61a82e256555d6149193">min_hbond_dist</a>) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00269"></a>00269       }<span class="keywordflow">else</span> <span class="keywordflow">if</span>((a.<a class="code" href="classSimSite3D_1_1atom__t.html#0649f5881857d9437b85dfec852f5a88">act_type</a> == ACCEPTOR || a.<a class="code" href="classSimSite3D_1_1atom__t.html#0649f5881857d9437b85dfec852f5a88">act_type</a> == DONEPTOR) &amp;&amp; 
<a name="l00270"></a>00270          (b.<a class="code" href="classSimSite3D_1_1atom__t.html#0649f5881857d9437b85dfec852f5a88">act_type</a> == DONOR || b.<a class="code" href="classSimSite3D_1_1atom__t.html#0649f5881857d9437b85dfec852f5a88">act_type</a> == DONEPTOR)){
<a name="l00271"></a>00271         <span class="keywordflow">if</span>(dd &lt; <a class="code" href="classSimSite3D_1_1CoordFile.html#24508f2022eb61a82e256555d6149193">min_hbond_dist</a>*<a class="code" href="classSimSite3D_1_1CoordFile.html#24508f2022eb61a82e256555d6149193">min_hbond_dist</a>) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00272"></a>00272       <span class="comment">// Metals</span>
<a name="l00273"></a>00273       <span class="comment">// Only prot metals for now -- i.e. metals exist in the protein PDB file</span>
<a name="l00274"></a>00274       <span class="comment">// This was modified as per Matt &amp; Leslie's suggestion -- we could get too</span>
<a name="l00275"></a>00275       <span class="comment">// close, but in general we are clipping ligand atoms that are rigidly </span>
<a name="l00276"></a>00276       <span class="comment">// bonded to the acceptors interacting with the metals</span>
<a name="l00277"></a>00277       }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(b.<a class="code" href="classSimSite3D_1_1atom__t.html#b3b7b5f7e8172387dd581dcacc4a9f72">res</a> == PDB_METAL){    
<a name="l00278"></a>00278         <span class="keyword">const</span> <a class="code" href="structSimSite3D_1_1pdb__metal__info__t.html">pdb_metal_info_t</a>* m_info = <a class="code" href="classSimSite3D_1_1PDB__metals.html#ee311afb288f71f33ef60d4079bcd407">PDB_metals::lookup</a>(b.<a class="code" href="classSimSite3D_1_1atom__t.html#8d17fc5f8e49ef5e1bea2e89a0b6e600">name</a>);
<a name="l00279"></a>00279         <span class="keywordflow">if</span>(dd &lt; m_info-&gt;min_act_dist * m_info-&gt;<a class="code" href="structSimSite3D_1_1pdb__metal__info__t.html#eff78ccd9357744713418a32272b06ed">min_act_dist</a>) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00280"></a>00280       <span class="comment">// Van der Waals contact</span>
<a name="l00281"></a>00281       }<span class="keywordflow">else</span>{
<a name="l00282"></a>00282         my_float_t tmp = (a.<a class="code" href="classSimSite3D_1_1atom__t.html#1beb46018c79fd73df622a22540c341a">vdw_radius</a> + b.<a class="code" href="classSimSite3D_1_1atom__t.html#1beb46018c79fd73df622a22540c341a">vdw_radius</a> - <a class="code" href="classSimSite3D_1_1CoordFile.html#2952245169ead06df4ae1e44b9cd69b2">ALLOWED_OVERLAP</a>);
<a name="l00283"></a>00283         <span class="keywordflow">if</span>(dd &lt; tmp*tmp) <span class="keywordflow">return</span> <span class="keyword">true</span>; 
<a name="l00284"></a>00284         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00285"></a>00285       }
<a name="l00286"></a>00286       <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00287"></a>00287     }
<a name="l00288"></a>00288 
<a name="l00289"></a>00289 
<a name="l00290"></a><a class="code" href="classSimSite3D_1_1CoordFile.html#e6fd931154c7b8e59298b58f592f7799">00290</a>     <a class="code" href="classSimSite3D_1_1point__storage.html">point_storage&lt;atom_t&gt;</a> <a class="code" href="classSimSite3D_1_1CoordFile.html#e6fd931154c7b8e59298b58f592f7799">atoms</a>; 
<a name="l00291"></a><a class="code" href="classSimSite3D_1_1CoordFile.html#4080cb23aeba4b34ac77e37dcc6d9f0c">00291</a>     atom_map_t <a class="code" href="classSimSite3D_1_1CoordFile.html#4080cb23aeba4b34ac77e37dcc6d9f0c">atoms_by_num</a>;    
<a name="l00292"></a><a class="code" href="classSimSite3D_1_1CoordFile.html#75d613311625154ae2d08009fcfa29b2">00292</a>     std::string <a class="code" href="classSimSite3D_1_1CoordFile.html#75d613311625154ae2d08009fcfa29b2">name_of_file</a>;   
<a name="l00293"></a><a class="code" href="classSimSite3D_1_1CoordFile.html#2952245169ead06df4ae1e44b9cd69b2">00293</a>     <span class="keyword">static</span> <span class="keyword">const</span> my_float_t <a class="code" href="classSimSite3D_1_1CoordFile.html#2952245169ead06df4ae1e44b9cd69b2">ALLOWED_OVERLAP</a>; 
<a name="l00294"></a><a class="code" href="classSimSite3D_1_1CoordFile.html#24508f2022eb61a82e256555d6149193">00294</a>     <span class="keyword">static</span> <span class="keyword">const</span> my_float_t <a class="code" href="classSimSite3D_1_1CoordFile.html#24508f2022eb61a82e256555d6149193">min_hbond_dist</a>;  
<a name="l00295"></a><a class="code" href="classSimSite3D_1_1CoordFile.html#0b784057f780e3960b89ed6f8a25adff">00295</a>     <span class="keywordtype">bool</span> <a class="code" href="classSimSite3D_1_1CoordFile.html#0b784057f780e3960b89ed6f8a25adff">A_fail</a>;     
<a name="l00296"></a><a class="code" href="classSimSite3D_1_1CoordFile.html#a4a1ec62ac2e45dfb39dc68d91c04905">00296</a>     <span class="keyword">static</span> <span class="keyword">const</span> std::string <a class="code" href="classSimSite3D_1_1CoordFile.html#a4a1ec62ac2e45dfb39dc68d91c04905">A_fname</a>;  
<a name="l00297"></a>00297   };
<a name="l00298"></a>00298 
<a name="l00300"></a>00300 
<a name="l00302"></a>00302   <span class="keyword">inline</span> my_float_t 
<a name="l00303"></a>00303   simple_rmsd(<span class="keyword">const</span> <a class="code" href="classSimSite3D_1_1CoordFile.html">CoordFile</a>&amp; f1, <span class="keyword">const</span> <a class="code" href="classSimSite3D_1_1CoordFile.html">CoordFile</a>&amp; f2)
<a name="l00304"></a>00304   {
<a name="l00305"></a>00305     atom_vci a1 = f1.<a class="code" href="classSimSite3D_1_1CoordFile.html#e6fd931154c7b8e59298b58f592f7799">atoms</a>.begin();
<a name="l00306"></a>00306     atom_vci a2 = f2.<a class="code" href="classSimSite3D_1_1CoordFile.html#e6fd931154c7b8e59298b58f592f7799">atoms</a>.begin();
<a name="l00307"></a>00307     my_float_t err = 0;
<a name="l00308"></a>00308     my_float_t n = 0;
<a name="l00309"></a>00309     <span class="keywordflow">for</span>( ; a1 != f1.<a class="code" href="classSimSite3D_1_1CoordFile.html#e6fd931154c7b8e59298b58f592f7799">atoms</a>.end() &amp;&amp; a2 != f2.<a class="code" href="classSimSite3D_1_1CoordFile.html#e6fd931154c7b8e59298b58f592f7799">atoms</a>.end(); ++a1, ++a2){
<a name="l00310"></a>00310       <span class="keywordflow">if</span>(a1-&gt;name != a2-&gt;name)
<a name="l00311"></a>00311         std::cerr &lt;&lt; <span class="stringliteral">"in RMSD a1 and a2 have different names\n"</span>;
<a name="l00312"></a>00312       <span class="keywordflow">if</span>(a1-&gt;name != H || a2-&gt;name != H){
<a name="l00313"></a>00313         err += dist_squared(a1-&gt;pos, a2-&gt;pos);
<a name="l00314"></a>00314         ++n;
<a name="l00315"></a>00315       }
<a name="l00316"></a>00316     }
<a name="l00317"></a>00317     <span class="keywordflow">return</span> std::sqrt(err / n);
<a name="l00318"></a>00318   }
<a name="l00319"></a>00319 
<a name="l00320"></a>00320 }
<a name="l00321"></a>00321 <span class="preprocessor">#endif</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Apr 3 23:09:17 2012 for simsite3d by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
