<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>simsite3d: point_storage.H Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
  </ul></div>
<h1>point_storage.H</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/******************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment"> * Copyright (c) 2006,2007, Michigan State University (MSU) Board of Trustees.</span>
<a name="l00003"></a>00003 <span class="comment"> *   All rights reserved.</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> * This file is part of the SimSite3D Software project.</span>
<a name="l00006"></a>00006 <span class="comment"> *</span>
<a name="l00007"></a>00007 <span class="comment"> * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<a name="l00008"></a>00008 <span class="comment"> * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<a name="l00009"></a>00009 <span class="comment"> * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<a name="l00010"></a>00010 <span class="comment"> * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<a name="l00011"></a>00011 <span class="comment"> * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<a name="l00012"></a>00012 <span class="comment"> * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<a name="l00013"></a>00013 <span class="comment"> * THE SOFTWARE.</span>
<a name="l00014"></a>00014 <span class="comment"> *</span>
<a name="l00015"></a>00015 <span class="comment"> * Authors: Jeffrey Van Voorst, jeff.vanvoorst@gmail.com</span>
<a name="l00016"></a>00016 <span class="comment"> *          Leslie Kuhn, Ph.D., KuhnL@msu.edu </span>
<a name="l00017"></a>00017 <span class="comment"> *****************************************************************************/</span>
<a name="l00018"></a>00018   
<a name="l00019"></a>00019 <span class="comment">/*</span>
<a name="l00020"></a>00020 <span class="comment"> * $Source: /psa/share/repository/pfizer_proj/src/basics/point_storage.H,v $</span>
<a name="l00021"></a>00021 <span class="comment"> * $Revision: 1.7 $</span>
<a name="l00022"></a>00022 <span class="comment"> * $Author: vanvoor4 $</span>
<a name="l00023"></a>00023 <span class="comment"> * $Date: 2009-01-12 20:50:42 $</span>
<a name="l00024"></a>00024 <span class="comment"> * </span>
<a name="l00025"></a>00025 <span class="comment"> * $Log: not supported by cvs2svn $</span>
<a name="l00026"></a>00026 <span class="comment"> * Revision 1.6  2008/07/28 15:14:24  vanvoor4</span>
<a name="l00027"></a>00027 <span class="comment"> * Added function to get all points within some radius of another point</span>
<a name="l00028"></a>00028 <span class="comment"> * Added a number of Doxygen comments</span>
<a name="l00029"></a>00029 <span class="comment"> *</span>
<a name="l00030"></a>00030 <span class="comment"> * Revision 1.5  2008/02/26 19:15:22  vanvoor4</span>
<a name="l00031"></a>00031 <span class="comment"> * Removed the old octree stuff, and started with the new, but not</span>
<a name="l00032"></a>00032 <span class="comment"> * implemented as yet.</span>
<a name="l00033"></a>00033 <span class="comment"> *</span>
<a name="l00034"></a>00034 <span class="comment"> * Revision 1.4  2007/09/20 17:37:27  vanvoor4</span>
<a name="l00035"></a>00035 <span class="comment"> * Added support for Octree</span>
<a name="l00036"></a>00036 <span class="comment"> *</span>
<a name="l00037"></a>00037 <span class="comment"> * Revision 1.3  2007/08/29 20:13:49  vanvoor4</span>
<a name="l00038"></a>00038 <span class="comment"> * Added wrapper to centroid</span>
<a name="l00039"></a>00039 <span class="comment"> *</span>
<a name="l00040"></a>00040 <span class="comment"> * Revision 1.2  2007/08/21 20:59:11  vanvoor4</span>
<a name="l00041"></a>00041 <span class="comment"> * Added __GLIBCXX__ macro to support older versions of gcc</span>
<a name="l00042"></a>00042 <span class="comment"> *</span>
<a name="l00043"></a>00043 <span class="comment"> * Revision 1.1  2007/08/21 15:55:03  vanvoor4</span>
<a name="l00044"></a>00044 <span class="comment"> * Initial checkin</span>
<a name="l00045"></a>00045 <span class="comment"> *</span>
<a name="l00046"></a>00046 <span class="comment"> *</span>
<a name="l00047"></a>00047 <span class="comment"> * </span>
<a name="l00048"></a>00048 <span class="comment"> * </span>
<a name="l00049"></a>00049 <span class="comment"> */</span> 
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 <span class="preprocessor">#ifndef POINT_STORAGE_HEADER_INCLUDED</span>
<a name="l00052"></a>00052 <span class="preprocessor"></span><span class="preprocessor">#define POINT_STORAGE_HEADER_INCLUDED</span>
<a name="l00053"></a>00053 <span class="preprocessor"></span>
<a name="l00054"></a>00054 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &lt;iterator&gt;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &lt;map&gt;</span>
<a name="l00057"></a>00057 <span class="preprocessor">#include &lt;point.H&gt;</span>
<a name="l00058"></a>00058 <span class="preprocessor">#include &lt;my_float_array.H&gt;</span>
<a name="l00059"></a>00059 <span class="preprocessor">#include &lt;math_basics.H&gt;</span>
<a name="l00060"></a>00060 <span class="preprocessor">#include &lt;point_bins.H&gt;</span>
<a name="l00061"></a>00061 
<a name="l00062"></a>00062 <span class="keyword">namespace </span>SimSite3D{
<a name="l00063"></a>00063 
<a name="l00066"></a>00066   <span class="keyword">template</span>&lt;<span class="keyword">typename</span> _Tp, <span class="keyword">typename</span> _Sequence = std::vector&lt;_Tp&gt; &gt;
<a name="l00067"></a><a class="code" href="classSimSite3D_1_1point__storage.html">00067</a>   <span class="keyword">class </span><a class="code" href="classSimSite3D_1_1point__storage.html">point_storage</a>{
<a name="l00068"></a>00068     <span class="comment">// Concept requirements</span>
<a name="l00069"></a>00069     <span class="keyword">typedef</span> <span class="keyword">typename</span> _Sequence::value_type _Sequence_value_type;
<a name="l00070"></a>00070 <span class="preprocessor">#ifdef __GLIBCXX__</span>
<a name="l00071"></a>00071 <span class="preprocessor"></span>    __glibcxx_class_requires(_Tp, _SGIAssignableConcept);
<a name="l00072"></a>00072     __glibcxx_class_requires(_Sequence, _BackInsertionSequenceConcept);
<a name="l00073"></a>00073     __glibcxx_class_requires2(_Tp, _Sequence_value_type, _SameTypeConcept);
<a name="l00074"></a>00074 <span class="preprocessor">#else</span>
<a name="l00075"></a>00075 <span class="preprocessor"></span>    __glibcpp_class_requires(_Tp, _SGIAssignableConcept);
<a name="l00076"></a>00076     __glibcpp_class_requires(_Sequence, _BackInsertionSequenceConcept);
<a name="l00077"></a>00077     __glibcpp_class_requires2(_Tp, _Sequence_value_type, _SameTypeConcept);
<a name="l00078"></a>00078 <span class="preprocessor">#endif</span>
<a name="l00079"></a>00079 <span class="preprocessor"></span>
<a name="l00080"></a>00080   <span class="keyword">public</span>:
<a name="l00081"></a>00081     <span class="keyword">typedef</span> <span class="keyword">typename</span> _Sequence::value_type              value_type;
<a name="l00082"></a>00082     <span class="keyword">typedef</span> <span class="keyword">typename</span> _Sequence::reference               reference;
<a name="l00083"></a>00083     <span class="keyword">typedef</span> <span class="keyword">typename</span> _Sequence::const_reference         const_reference;
<a name="l00084"></a>00084     <span class="keyword">typedef</span> <span class="keyword">typename</span> _Sequence::iterator                iterator;
<a name="l00085"></a>00085     <span class="keyword">typedef</span> <span class="keyword">typename</span> _Sequence::const_iterator          const_iterator;
<a name="l00086"></a>00086     <span class="keyword">typedef</span> <span class="keyword">typename</span> _Sequence::size_type               size_type;
<a name="l00087"></a>00087     <span class="keyword">typedef</span> <span class="keyword">typename</span> _Sequence::iterator::iterator_category iterator_category;
<a name="l00088"></a>00088     <span class="keyword">typedef</span>          _Sequence                          container_type;
<a name="l00089"></a>00089 
<a name="l00090"></a>00090     <span class="keyword">typedef</span> <span class="keyword">typename</span> <a class="code" href="classSimSite3D_1_1point__bins.html">point_bins&lt;const_iterator&gt;::bin_vci</a>        bins_vci_type;
<a name="l00091"></a>00091     <span class="keyword">typedef</span>          <a class="code" href="classSimSite3D_1_1point__bins.html">point_bins&lt;const_iterator&gt;</a>                 <a class="code" href="classSimSite3D_1_1point__bins.html">bins_type</a>;
<a name="l00092"></a>00092 
<a name="l00093"></a>00093     <span class="keyword">typedef</span> std::pair&lt;my_float_t, const_iterator&gt; float_const_iter_pair;
<a name="l00094"></a>00094     <span class="keyword">typedef</span> std::multimap&lt;my_float_t, const_iterator&gt; float_const_iter_map;
<a name="l00095"></a>00095   <span class="keyword">protected</span>:
<a name="l00096"></a>00096     _Sequence Container;
<a name="l00097"></a>00097     <a class="code" href="classSimSite3D_1_1my__float__array.html">my_float_array</a> positions;
<a name="l00098"></a>00098 
<a name="l00099"></a>00099   <span class="keyword">public</span>:
<a name="l00100"></a>00100     <a class="code" href="classSimSite3D_1_1point__storage.html">point_storage</a>(uint init_num_pts = 150, uint stride_in = 3)
<a name="l00101"></a>00101       : positions(init_num_pts, stride_in)
<a name="l00102"></a>00102     {
<a name="l00103"></a>00103       A_has_been_transformed = <span class="keyword">false</span>;
<a name="l00104"></a>00104     }
<a name="l00105"></a>00105 
<a name="l00106"></a>00106     <a class="code" href="classSimSite3D_1_1point__storage.html">point_storage</a>(<span class="keyword">const</span> <a class="code" href="classSimSite3D_1_1point__storage.html">point_storage</a>&amp; src) : positions(src.<a class="code" href="classSimSite3D_1_1point__storage.html#604415d42b6f03d7269873cdd5c41bc2">positions</a>)
<a name="l00107"></a>00107     {
<a name="l00108"></a>00108       <a class="code" href="classSimSite3D_1_1point__storage.html#88a0b4dff13887825af1ca7529a24778">do_copy</a>(src);
<a name="l00109"></a>00109     }
<a name="l00110"></a>00110 
<a name="l00111"></a>00111     <span class="keyword">const</span> <a class="code" href="classSimSite3D_1_1point__storage.html">point_storage</a>&amp;
<a name="l00112"></a>00112     operator=(<span class="keyword">const</span> <a class="code" href="classSimSite3D_1_1point__storage.html">point_storage</a>&amp; src)
<a name="l00113"></a>00113     {
<a name="l00114"></a>00114       <span class="keywordflow">if</span>(<span class="keyword">this</span> != &amp;src){
<a name="l00115"></a>00115         positions = src.<a class="code" href="classSimSite3D_1_1point__storage.html#604415d42b6f03d7269873cdd5c41bc2">positions</a>;
<a name="l00116"></a>00116         <a class="code" href="classSimSite3D_1_1point__storage.html#88a0b4dff13887825af1ca7529a24778">do_copy</a>(src);
<a name="l00117"></a>00117       }
<a name="l00118"></a>00118       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00119"></a>00119     }
<a name="l00120"></a>00120 
<a name="l00121"></a>00121     <span class="keyword">virtual</span> ~<a class="code" href="classSimSite3D_1_1point__storage.html">point_storage</a>()
<a name="l00122"></a>00122     {
<a name="l00123"></a>00123     }
<a name="l00124"></a>00124 
<a name="l00126"></a>00126     <span class="keyword">const</span> my_float_t*
<a name="l00127"></a><a class="code" href="classSimSite3D_1_1point__storage.html#4179b369dfa5b1277da5db9e3e9cb0c1">00127</a>     <a class="code" href="classSimSite3D_1_1point__storage.html#4179b369dfa5b1277da5db9e3e9cb0c1">points_begin</a>()<span class="keyword"> const</span>
<a name="l00128"></a>00128 <span class="keyword">    </span>{ <span class="keywordflow">return</span> positions.<a class="code" href="classSimSite3D_1_1my__float__array.html#764b70c62326d6ed689ecc3fdce08c5a">begin</a>(); }
<a name="l00129"></a>00129 
<a name="l00131"></a>00131     <span class="keyword">const</span> my_float_t*
<a name="l00132"></a><a class="code" href="classSimSite3D_1_1point__storage.html#5406affe211bf9c423b577b6bb282b56">00132</a>     <a class="code" href="classSimSite3D_1_1point__storage.html#5406affe211bf9c423b577b6bb282b56">points_end</a>()<span class="keyword"> const</span>
<a name="l00133"></a>00133 <span class="keyword">    </span>{ <span class="keywordflow">return</span> positions.<a class="code" href="classSimSite3D_1_1my__float__array.html#62e4444b755858beec023de8d9fceeef">end</a>(); }
<a name="l00134"></a>00134 
<a name="l00136"></a>00136     const_iterator
<a name="l00137"></a><a class="code" href="classSimSite3D_1_1point__storage.html#137cc46a9b6a9eed4a2966b1c2652802">00137</a>     <a class="code" href="classSimSite3D_1_1point__storage.html#137cc46a9b6a9eed4a2966b1c2652802">begin</a>()<span class="keyword"> const </span>
<a name="l00138"></a>00138 <span class="keyword">    </span>{ <span class="keywordflow">return</span> Container.begin(); }
<a name="l00139"></a>00139 
<a name="l00141"></a>00141     const_iterator
<a name="l00142"></a><a class="code" href="classSimSite3D_1_1point__storage.html#55e058eb0fc22f701fd441641cd49d83">00142</a>     <a class="code" href="classSimSite3D_1_1point__storage.html#55e058eb0fc22f701fd441641cd49d83">end</a>()<span class="keyword"> const </span>
<a name="l00143"></a>00143 <span class="keyword">    </span>{ <span class="keywordflow">return</span> Container.end(); }
<a name="l00144"></a>00144 
<a name="l00146"></a>00146     iterator
<a name="l00147"></a><a class="code" href="classSimSite3D_1_1point__storage.html#83805a7e465cb05a7d94f42bd14d3626">00147</a>     <a class="code" href="classSimSite3D_1_1point__storage.html#137cc46a9b6a9eed4a2966b1c2652802">begin</a>()
<a name="l00148"></a>00148     { <span class="keywordflow">return</span> Container.begin(); }
<a name="l00149"></a>00149 
<a name="l00151"></a>00151     iterator
<a name="l00152"></a><a class="code" href="classSimSite3D_1_1point__storage.html#9385b69e57a30908b798d1b7aea79437">00152</a>     <a class="code" href="classSimSite3D_1_1point__storage.html#55e058eb0fc22f701fd441641cd49d83">end</a>()
<a name="l00153"></a>00153     { <span class="keywordflow">return</span> Container.end(); }
<a name="l00154"></a>00154 
<a name="l00156"></a>00156     size_type
<a name="l00157"></a><a class="code" href="classSimSite3D_1_1point__storage.html#598615e1ca68e12e1f7ae8446758e608">00157</a>     <a class="code" href="classSimSite3D_1_1point__storage.html#598615e1ca68e12e1f7ae8446758e608">size</a>()<span class="keyword"> const</span>
<a name="l00158"></a>00158 <span class="keyword">    </span>{ <span class="keywordflow">return</span> Container.size(); }
<a name="l00159"></a>00159 
<a name="l00162"></a>00162     <span class="keywordtype">void</span> 
<a name="l00163"></a><a class="code" href="classSimSite3D_1_1point__storage.html#b1e42dc1e766408149125759061291a6">00163</a>     <a class="code" href="classSimSite3D_1_1point__storage.html#b1e42dc1e766408149125759061291a6">push_back</a>(<span class="keyword">const</span> value_type&amp; __x)
<a name="l00164"></a>00164     {
<a name="l00165"></a>00165       Container.push_back(__x);
<a name="l00166"></a>00166       value_type&amp; b = Container.back();
<a name="l00167"></a>00167       <span class="keywordflow">if</span>(positions.<a class="code" href="classSimSite3D_1_1my__float__array.html#d1cf330a07c7789f5ef224cc93374277">push_back</a>(__x.pos) == MY_FLOAT_ARRAY_GREW){
<a name="l00168"></a>00168         b.delete_pos();
<a name="l00169"></a>00169         my_float_t* p = positions.<a class="code" href="classSimSite3D_1_1my__float__array.html#764b70c62326d6ed689ecc3fdce08c5a">begin</a>();
<a name="l00170"></a>00170         <span class="keywordflow">for</span>(iterator s = Container.begin(); 
<a name="l00171"></a>00171             p &lt; positions.<a class="code" href="classSimSite3D_1_1my__float__array.html#62e4444b755858beec023de8d9fceeef">end</a>() &amp;&amp; s != Container.end(); ++s){
<a name="l00172"></a>00172           s-&gt;pos = p;
<a name="l00173"></a>00173           p += positions.<a class="code" href="classSimSite3D_1_1my__float__array.html#ca02b23f8fd6e8a60a28e4cfae8a648e">stride</a>(); 
<a name="l00174"></a>00174         }
<a name="l00175"></a>00175       }<span class="keywordflow">else</span>{
<a name="l00176"></a>00176         b.delete_pos();
<a name="l00177"></a>00177         b.pos = positions.<a class="code" href="classSimSite3D_1_1my__float__array.html#62e4444b755858beec023de8d9fceeef">end</a>() - positions.<a class="code" href="classSimSite3D_1_1my__float__array.html#ca02b23f8fd6e8a60a28e4cfae8a648e">stride</a>();
<a name="l00178"></a>00178       }
<a name="l00179"></a>00179     }
<a name="l00180"></a>00180 
<a name="l00182"></a>00182     iterator 
<a name="l00183"></a><a class="code" href="classSimSite3D_1_1point__storage.html#257e54a362a5f8eab82b0d431f671903">00183</a>     <a class="code" href="classSimSite3D_1_1point__storage.html#257e54a362a5f8eab82b0d431f671903">erase</a>(iterator __i)
<a name="l00184"></a>00184     { <span class="keywordflow">return</span> Container.erase(__i); }
<a name="l00185"></a>00185 
<a name="l00186"></a>00186     <span class="comment">// Don't forget to transform A_otree if it is not null</span>
<a name="l00188"></a>00188 <span class="comment"></span>    <span class="keywordtype">void</span> 
<a name="l00189"></a><a class="code" href="classSimSite3D_1_1point__storage.html#f90d2e349c29b237403efe80c4377a2a">00189</a>     <a class="code" href="classSimSite3D_1_1point__storage.html#f90d2e349c29b237403efe80c4377a2a">transform</a>(<span class="keyword">const</span> my_float_t* R, <span class="keyword">const</span> my_float_t* T)
<a name="l00190"></a>00190     { 
<a name="l00191"></a>00191       A_has_been_transformed = <span class="keyword">true</span>;
<a name="l00192"></a>00192       positions.<a class="code" href="classSimSite3D_1_1my__float__array.html#6539a83a54fe3c26d54f4bce4bfc7057">transform3D</a>(R, T); 
<a name="l00193"></a>00193       A_bins.<a class="code" href="classSimSite3D_1_1point__bins.html#ae0c63c318c55d37a6abf7f8760f0bd9">transform_bins</a>(R, T);
<a name="l00194"></a>00194     }
<a name="l00195"></a>00195 
<a name="l00197"></a>00197     <span class="keywordtype">void</span> 
<a name="l00198"></a><a class="code" href="classSimSite3D_1_1point__storage.html#20a59aecf6978920fa2bcf8be845dfc0">00198</a>     <a class="code" href="classSimSite3D_1_1point__storage.html#20a59aecf6978920fa2bcf8be845dfc0">inverse_transform</a>(<span class="keyword">const</span> my_float_t* R, <span class="keyword">const</span> my_float_t* T)
<a name="l00199"></a>00199     { 
<a name="l00200"></a>00200       A_has_been_transformed = <span class="keyword">true</span>;
<a name="l00201"></a>00201       positions.<a class="code" href="classSimSite3D_1_1my__float__array.html#36cecd78c077ff31ded38a0194b862f2">inverse_transform3D</a>(R, T); 
<a name="l00202"></a>00202       A_bins.<a class="code" href="classSimSite3D_1_1point__bins.html#ecf57c0678d1fec450842dfef3b81a97">inverse_transform_bins</a>(R, T);
<a name="l00203"></a>00203     }
<a name="l00204"></a>00204 
<a name="l00206"></a>00206     <span class="keywordtype">void</span> 
<a name="l00207"></a><a class="code" href="classSimSite3D_1_1point__storage.html#f08419a1ed01d6bc8de1486a5811da83">00207</a>     <a class="code" href="classSimSite3D_1_1point__storage.html#f08419a1ed01d6bc8de1486a5811da83">revert</a>() 
<a name="l00208"></a>00208     { 
<a name="l00209"></a>00209       positions.<a class="code" href="classSimSite3D_1_1my__float__array.html#5612962a30bbc36661eab21d94a172a7">revert</a>(); 
<a name="l00210"></a>00210       A_bins.<a class="code" href="classSimSite3D_1_1point__bins.html#a68b236a6dcfb2a1d344ae6b2cf3a7e3">revert</a>();
<a name="l00211"></a>00211       A_has_been_transformed = <span class="keyword">false</span>;
<a name="l00212"></a>00212     }
<a name="l00213"></a>00213 
<a name="l00216"></a>00216     <span class="keywordtype">void</span>
<a name="l00217"></a><a class="code" href="classSimSite3D_1_1point__storage.html#e841ba62806a65a9fdbd79a4d8bf968a">00217</a>     <a class="code" href="classSimSite3D_1_1point__storage.html#e841ba62806a65a9fdbd79a4d8bf968a">set_current_positions_as_original</a>()
<a name="l00218"></a>00218     {
<a name="l00219"></a>00219       positions.<a class="code" href="classSimSite3D_1_1my__float__array.html#a98bd8a8f5970ca4cd7523e15a0af9f8">set_current_values_as_original</a>();
<a name="l00220"></a>00220       <span class="keywordflow">if</span>(A_bins.<a class="code" href="classSimSite3D_1_1point__bins.html#c748633d67a3d339c7a895b43666aec1">bins_are_setup</a>()){
<a name="l00221"></a>00221         std::cerr &lt;&lt; <span class="stringliteral">"Need to rebin the points!!\n"</span>;
<a name="l00222"></a>00222       }
<a name="l00223"></a>00223     }
<a name="l00224"></a>00224 
<a name="l00226"></a>00226     <span class="keyword">inline</span> <span class="keywordtype">void</span> 
<a name="l00227"></a><a class="code" href="classSimSite3D_1_1point__storage.html#a8b7d0c0bc834f02e4ad877b8dc1f147">00227</a>     <a class="code" href="classSimSite3D_1_1point__storage.html#a8b7d0c0bc834f02e4ad877b8dc1f147">get_current_inverse_3D_transform</a>(Quaternion *Q, my_float_t *T)<span class="keyword"> const</span>
<a name="l00228"></a>00228 <span class="keyword">    </span>{
<a name="l00229"></a>00229       positions.<a class="code" href="classSimSite3D_1_1my__float__array.html#f341a7e9e7bde491843bf95e61650eee">get_current_inverse_3D_transform</a>(Q, T);
<a name="l00230"></a>00230     }
<a name="l00231"></a>00231 
<a name="l00234"></a>00234     <span class="keyword">inline</span> my_float_t
<a name="l00235"></a><a class="code" href="classSimSite3D_1_1point__storage.html#daaeae9e9bfdf971409b15a2b04b761c">00235</a>     <a class="code" href="classSimSite3D_1_1point__storage.html#daaeae9e9bfdf971409b15a2b04b761c">compute_RMSD</a>()<span class="keyword"> const</span>
<a name="l00236"></a>00236 <span class="keyword">    </span>{ <span class="keywordflow">return</span> positions.<a class="code" href="classSimSite3D_1_1my__float__array.html#ea4337b692bde44840c4affc07cf7095">compute_RMSD</a>(); }
<a name="l00237"></a>00237 
<a name="l00238"></a>00238 
<a name="l00240"></a>00240     <span class="keyword">const</span> <span class="keywordtype">bool</span>
<a name="l00241"></a><a class="code" href="classSimSite3D_1_1point__storage.html#66a712bb966c3433d12563eca592be2a">00241</a>     <a class="code" href="classSimSite3D_1_1point__storage.html#66a712bb966c3433d12563eca592be2a">centroid_3D</a>(my_float_t* C)<span class="keyword"> const</span>
<a name="l00242"></a>00242 <span class="keyword">    </span>{ <span class="keywordflow">return</span> positions.<a class="code" href="classSimSite3D_1_1my__float__array.html#c716853fd605ff6e32d4ede02cedb7b0">centroid_3D</a>(C); }
<a name="l00243"></a>00243 
<a name="l00246"></a>00246 
<a name="l00253"></a>00253     const_iterator
<a name="l00254"></a><a class="code" href="classSimSite3D_1_1point__storage.html#99dcbb083379f7f193c0655a5e7e03aa">00254</a>     <a class="code" href="classSimSite3D_1_1point__storage.html#99dcbb083379f7f193c0655a5e7e03aa">closest_point</a>(<span class="keyword">const</span> my_float_t *a_pos, my_float_t *d_out)<span class="keyword"> const</span>
<a name="l00255"></a>00255 <span class="keyword">    </span>{ 
<a name="l00256"></a>00256       <span class="keywordflow">if</span>(A_bins.<a class="code" href="classSimSite3D_1_1point__bins.html#c748633d67a3d339c7a895b43666aec1">bins_are_setup</a>()){
<a name="l00257"></a>00257         *d_out = my_float_max;
<a name="l00258"></a>00258         my_float_t min_dist_sq = my_float_max;
<a name="l00259"></a>00259         bins_vci_type bin, moved_bin; 
<a name="l00260"></a>00260         A_bins.<a class="code" href="classSimSite3D_1_1point__bins.html#3efe4ebd6c36993e1be9802c8edf1c35">get_bin</a>(a_pos, &amp;bin, &amp;moved_bin);
<a name="l00261"></a>00261         <span class="keywordflow">if</span>(bin &gt;= A_bins.<a class="code" href="classSimSite3D_1_1point__bins.html#f9c9f7b5c7be74b76b0eba306879324d">bins_end</a>()) <span class="keywordflow">return</span> Container.end();
<a name="l00262"></a>00262 
<a name="l00263"></a>00263         size_t best_idx = 0;
<a name="l00264"></a>00264         <span class="keywordflow">for</span>(size_t i = 0; i &lt; bin-&gt;positions.size(); ++i){
<a name="l00265"></a>00265           my_float_t dist_sq = dist_squared(bin-&gt;positions[i], a_pos);
<a name="l00266"></a>00266           <span class="keywordflow">if</span>(dist_sq &lt; min_dist_sq){
<a name="l00267"></a>00267             min_dist_sq = dist_sq;
<a name="l00268"></a>00268             best_idx = i;
<a name="l00269"></a>00269           }
<a name="l00270"></a>00270         }
<a name="l00271"></a>00271         const_iterator rv =  bin-&gt;assoc_data[best_idx]; 
<a name="l00272"></a>00272 
<a name="l00273"></a>00273         <span class="keywordtype">bool</span> closer_to_moved_pt = <span class="keyword">false</span>;
<a name="l00274"></a>00274         <span class="keywordflow">for</span>(size_t i = 0; i &lt; moved_bin-&gt;positions.size(); ++i){
<a name="l00275"></a>00275           my_float_t dist_sq = dist_squared(moved_bin-&gt;positions[i], a_pos);
<a name="l00276"></a>00276           <span class="keywordflow">if</span>(dist_sq &lt; min_dist_sq){
<a name="l00277"></a>00277             min_dist_sq = dist_sq;
<a name="l00278"></a>00278             best_idx = i;
<a name="l00279"></a>00279             closer_to_moved_pt = <span class="keyword">true</span>;
<a name="l00280"></a>00280           }
<a name="l00281"></a>00281         }
<a name="l00282"></a>00282         <span class="keywordflow">if</span>(closer_to_moved_pt) rv = moved_bin-&gt;assoc_data[best_idx]; 
<a name="l00283"></a>00283 
<a name="l00284"></a>00284         *d_out = std::sqrt(min_dist_sq);
<a name="l00285"></a>00285         <span class="keywordflow">return</span> rv;
<a name="l00286"></a>00286       }<span class="keywordflow">else</span>
<a name="l00287"></a>00287         <span class="keywordflow">return</span> <a class="code" href="classSimSite3D_1_1point__storage.html#3bc1d840ac575c316bfea6fb23d75507">_closest_point</a>(a_pos, d_out, iterator_category()); 
<a name="l00288"></a>00288     }
<a name="l00289"></a>00289 
<a name="l00291"></a>00291     const_iterator
<a name="l00292"></a><a class="code" href="classSimSite3D_1_1point__storage.html#3bc1d840ac575c316bfea6fb23d75507">00292</a>     <a class="code" href="classSimSite3D_1_1point__storage.html#3bc1d840ac575c316bfea6fb23d75507">_closest_point</a>(<span class="keyword">const</span> my_float_t *a_pos, my_float_t *d_out, 
<a name="l00293"></a>00293                    std::random_access_iterator_tag tag)<span class="keyword"> const</span>
<a name="l00294"></a>00294 <span class="keyword">    </span>{
<a name="l00295"></a>00295       my_float_t min_dist = my_float_max; 
<a name="l00296"></a>00296       uint best_idx = 0;
<a name="l00297"></a>00297       uint cnt = 0;
<a name="l00298"></a>00298       my_float_t* b_pos;
<a name="l00299"></a>00299       <span class="keywordflow">for</span>(b_pos = positions.<a class="code" href="classSimSite3D_1_1my__float__array.html#764b70c62326d6ed689ecc3fdce08c5a">begin</a>(); b_pos &lt; positions.<a class="code" href="classSimSite3D_1_1my__float__array.html#62e4444b755858beec023de8d9fceeef">end</a>(); b_pos += 3){
<a name="l00300"></a>00300         my_float_t d = dist(a_pos, b_pos);
<a name="l00301"></a>00301         <span class="keywordflow">if</span>(d &lt; min_dist){
<a name="l00302"></a>00302           best_idx = cnt;
<a name="l00303"></a>00303           min_dist = d;
<a name="l00304"></a>00304         }
<a name="l00305"></a>00305         ++cnt;
<a name="l00306"></a>00306       }
<a name="l00307"></a>00307       *d_out = min_dist;
<a name="l00308"></a>00308       <span class="keywordflow">return</span> Container.begin() + best_idx;
<a name="l00309"></a>00309     }
<a name="l00310"></a>00310 
<a name="l00312"></a>00312     const_iterator
<a name="l00313"></a><a class="code" href="classSimSite3D_1_1point__storage.html#96b7602e9af5661fdd0ba9f674c55f00">00313</a>     <a class="code" href="classSimSite3D_1_1point__storage.html#3bc1d840ac575c316bfea6fb23d75507">_closest_point</a>(<span class="keyword">const</span> my_float_t *a_pos, my_float_t* d_out, 
<a name="l00314"></a>00314                    std::forward_iterator_tag tag)<span class="keyword"> const</span>
<a name="l00315"></a>00315 <span class="keyword">    </span>{
<a name="l00316"></a>00316       my_float_t min_dist = my_float_max; 
<a name="l00317"></a>00317       const_iterator best;
<a name="l00318"></a>00318       const_iterator curr = Container.begin();
<a name="l00319"></a>00319       my_float_t* b_pos;
<a name="l00320"></a>00320       <span class="keywordflow">for</span>(b_pos = positions.<a class="code" href="classSimSite3D_1_1my__float__array.html#764b70c62326d6ed689ecc3fdce08c5a">begin</a>(); b_pos &lt; positions.<a class="code" href="classSimSite3D_1_1my__float__array.html#62e4444b755858beec023de8d9fceeef">end</a>(); b_pos += 3){
<a name="l00321"></a>00321         my_float_t d = dist(a_pos, b_pos);
<a name="l00322"></a>00322               <span class="keywordflow">if</span>(d &lt; min_dist){
<a name="l00323"></a>00323           best = curr;
<a name="l00324"></a>00324                 min_dist = d;
<a name="l00325"></a>00325               }
<a name="l00326"></a>00326               ++curr;
<a name="l00327"></a>00327       }
<a name="l00328"></a>00328       *d_out = min_dist;
<a name="l00329"></a>00329       <span class="keywordflow">return</span> best;
<a name="l00330"></a>00330     }
<a name="l00331"></a>00331 
<a name="l00333"></a>00333     <span class="keywordtype">void</span>
<a name="l00334"></a><a class="code" href="classSimSite3D_1_1point__storage.html#7552e9f80dc2a7c4c8c58fd7e6bb3858">00334</a>     <a class="code" href="classSimSite3D_1_1point__storage.html#7552e9f80dc2a7c4c8c58fd7e6bb3858">close_points</a>(<span class="keyword">const</span> my_float_t *a_pos, <span class="keyword">const</span> my_float_t radius,
<a name="l00335"></a>00335                  float_const_iter_map* pts_map)<span class="keyword"> const</span>
<a name="l00336"></a>00336 <span class="keyword">    </span>{
<a name="l00337"></a>00337       <span class="keyword">const</span> my_float_t radius_squared = radius*radius;
<a name="l00338"></a>00338 
<a name="l00339"></a>00339       <span class="keywordflow">if</span>(A_bins.<a class="code" href="classSimSite3D_1_1point__bins.html#c748633d67a3d339c7a895b43666aec1">bins_are_setup</a>()){
<a name="l00340"></a>00340         bins_vci_type bin, moved_bin; 
<a name="l00341"></a>00341         A_bins.<a class="code" href="classSimSite3D_1_1point__bins.html#3efe4ebd6c36993e1be9802c8edf1c35">get_bin</a>(a_pos, &amp;bin, &amp;moved_bin);
<a name="l00342"></a>00342         <span class="keywordflow">for</span>(size_t i = 0; i &lt; bin-&gt;positions.size(); ++i){
<a name="l00343"></a>00343           my_float_t d_squared = dist_squared(bin-&gt;positions[i], a_pos);
<a name="l00344"></a>00344           <span class="keywordflow">if</span>(d_squared &lt;= radius_squared)
<a name="l00345"></a>00345             pts_map-&gt;insert(float_const_iter_pair(std::sqrt(d_squared), 
<a name="l00346"></a>00346                                                   bin-&gt;assoc_data[i]));
<a name="l00347"></a>00347         }
<a name="l00348"></a>00348         <span class="keywordflow">for</span>(size_t i = 0; i &lt; moved_bin-&gt;positions.size(); ++i){
<a name="l00349"></a>00349           my_float_t d_squared = dist_squared(moved_bin-&gt;positions[i], a_pos);
<a name="l00350"></a>00350           <span class="keywordflow">if</span>(d_squared &lt;= radius_squared)
<a name="l00351"></a>00351             pts_map-&gt;insert(float_const_iter_pair(std::sqrt(d_squared), 
<a name="l00352"></a>00352                                                   moved_bin-&gt;assoc_data[i]));
<a name="l00353"></a>00353         }
<a name="l00354"></a>00354       }<span class="keywordflow">else</span>{
<a name="l00355"></a>00355         const_iterator iter = Container.begin();
<a name="l00356"></a>00356         my_float_t* b_pos = positions.<a class="code" href="classSimSite3D_1_1my__float__array.html#764b70c62326d6ed689ecc3fdce08c5a">begin</a>();
<a name="l00357"></a>00357         <span class="keywordflow">for</span>( ; iter != Container.end(); ++iter, b_pos += 3){
<a name="l00358"></a>00358           my_float_t d_squared = dist_squared(a_pos, b_pos);
<a name="l00359"></a>00359           <span class="keywordflow">if</span>(radius_squared &gt; d_squared)
<a name="l00360"></a>00360             pts_map-&gt;insert(float_const_iter_pair(std::sqrt(d_squared), iter));
<a name="l00361"></a>00361         }
<a name="l00362"></a>00362       }
<a name="l00363"></a>00363     }
<a name="l00364"></a>00364 
<a name="l00366"></a>00366     reference
<a name="l00367"></a><a class="code" href="classSimSite3D_1_1point__storage.html#7fe3b3db22e041f08c2261dececcae6b">00367</a>     <a class="code" href="classSimSite3D_1_1point__storage.html#7fe3b3db22e041f08c2261dececcae6b">front</a>()
<a name="l00368"></a>00368     { <span class="keywordflow">return</span> Container.front(); }
<a name="l00369"></a>00369 
<a name="l00371"></a>00371     <span class="keyword">const</span> reference
<a name="l00372"></a><a class="code" href="classSimSite3D_1_1point__storage.html#6ead8e9f3df6e5e128fe05a0220e04aa">00372</a>     <a class="code" href="classSimSite3D_1_1point__storage.html#7fe3b3db22e041f08c2261dececcae6b">front</a>()<span class="keyword"> const</span>
<a name="l00373"></a>00373 <span class="keyword">    </span>{ <span class="keywordflow">return</span> Container.front(); }
<a name="l00374"></a>00374 
<a name="l00376"></a>00376     reference
<a name="l00377"></a><a class="code" href="classSimSite3D_1_1point__storage.html#e52573f43d27b850351e64bf8e487dc4">00377</a>     <a class="code" href="classSimSite3D_1_1point__storage.html#e52573f43d27b850351e64bf8e487dc4">back</a>()
<a name="l00378"></a>00378     { <span class="keywordflow">return</span> Container.back(); }
<a name="l00379"></a>00379 
<a name="l00381"></a>00381     <span class="keyword">const</span> reference
<a name="l00382"></a><a class="code" href="classSimSite3D_1_1point__storage.html#97bdb4e3a0059504a65ad4b65f765f5c">00382</a>     <a class="code" href="classSimSite3D_1_1point__storage.html#e52573f43d27b850351e64bf8e487dc4">back</a>()<span class="keyword"> const </span>
<a name="l00383"></a>00383 <span class="keyword">    </span>{ <span class="keywordflow">return</span> Container.back(); }
<a name="l00384"></a>00384 
<a name="l00385"></a>00385 
<a name="l00386"></a>00386 <span class="preprocessor">#if 0</span>
<a name="l00387"></a>00387 <span class="preprocessor"></span>    <span class="comment">// Removed the const function "descriptor" since the first time through</span>
<a name="l00388"></a>00388     <span class="comment">// we will need to build the octree -- octree is not built first since</span>
<a name="l00389"></a>00389     <span class="comment">// we do not want the over head if the otree will not be used</span>
<a name="l00390"></a>00390     const_iterator
<a name="l00391"></a>00391     closest_point_test(<span class="keyword">const</span> my_float_t *a_pos, my_float_t *_d)
<a name="l00392"></a>00392     { <span class="keywordflow">return</span> _closest_point_test(a_pos, _d, iterator_category()); }
<a name="l00393"></a>00393 
<a name="l00394"></a>00394     const_iterator
<a name="l00395"></a>00395     _closest_point_test(<span class="keyword">const</span> my_float_t *a_pos, my_float_t *_d, 
<a name="l00396"></a>00396                         std::random_access_iterator_tag tag)
<a name="l00397"></a>00397     {
<a name="l00398"></a>00398       <span class="keywordflow">if</span>(A_otree == 0) build_otree();
<a name="l00399"></a>00399     }
<a name="l00400"></a>00400 <span class="preprocessor">#endif</span>
<a name="l00401"></a>00401 <span class="preprocessor"></span>
<a name="l00404"></a>00404 
<a name="l00407"></a>00407     <span class="keywordtype">void</span>
<a name="l00408"></a><a class="code" href="classSimSite3D_1_1point__storage.html#e629a1edb840a3177e9db2c1b4f46c22">00408</a>     <a class="code" href="classSimSite3D_1_1point__storage.html#e629a1edb840a3177e9db2c1b4f46c22">bin_points</a>(<span class="keyword">const</span> my_float_t max_dist)
<a name="l00409"></a>00409     {
<a name="l00410"></a>00410       <span class="keywordflow">if</span>(A_has_been_transformed)  
<a name="l00411"></a>00411         std::cerr &lt;&lt; <span class="stringliteral">"Cannot bin points after a global transform has been "</span>
<a name="l00412"></a>00412                   &lt;&lt; <span class="stringliteral">"applied\n"</span>; 
<a name="l00413"></a>00413       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!A_bins.<a class="code" href="classSimSite3D_1_1point__bins.html#c748633d67a3d339c7a895b43666aec1">bins_are_setup</a>())
<a name="l00414"></a>00414         A_bins.<a class="code" href="classSimSite3D_1_1point__bins.html#8a32f681bd20aa78a9b1cd3c0773be1e">setup_grid</a>(Container.begin(), Container.end(), max_dist);
<a name="l00415"></a>00415     }
<a name="l00416"></a>00416 
<a name="l00417"></a>00417     <span class="keyword">inline</span> <span class="keywordtype">void</span>
<a name="l00418"></a>00418     get_bin(<span class="keyword">const</span> my_float_t *pt, bins_vci_type *nbrs, 
<a name="l00419"></a>00419             bins_vci_type *moved_nbrs)<span class="keyword"> const</span>
<a name="l00420"></a>00420 <span class="keyword">    </span>{ <span class="keywordflow">return</span> A_bins.<a class="code" href="classSimSite3D_1_1point__bins.html#3efe4ebd6c36993e1be9802c8edf1c35">get_bin</a>(pt, nbrs, moved_nbrs); }
<a name="l00421"></a>00421 
<a name="l00422"></a>00422     <span class="keyword">inline</span> <span class="keywordtype">void</span>
<a name="l00423"></a>00423     write_bin_bounds(std::ostream &amp;out)<span class="keyword"> const</span>
<a name="l00424"></a>00424 <span class="keyword">    </span>{ A_bins.write_bounds(out); }
<a name="l00425"></a>00425 
<a name="l00426"></a>00426   <span class="keyword">private</span>:
<a name="l00427"></a>00427 
<a name="l00429"></a>00429     <span class="keywordtype">void</span>
<a name="l00430"></a><a class="code" href="classSimSite3D_1_1point__storage.html#88a0b4dff13887825af1ca7529a24778">00430</a>     <a class="code" href="classSimSite3D_1_1point__storage.html#88a0b4dff13887825af1ca7529a24778">do_copy</a>(<span class="keyword">const</span> <a class="code" href="classSimSite3D_1_1point__storage.html">point_storage</a>&amp; src)
<a name="l00431"></a>00431     {
<a name="l00432"></a>00432       A_has_been_transformed = src.<a class="code" href="classSimSite3D_1_1point__storage.html#0210eb0feee82c00756fd93c2d83bbdc">A_has_been_transformed</a>;
<a name="l00433"></a>00433       Container.clear();
<a name="l00434"></a>00434       Container.reserve(src.<a class="code" href="classSimSite3D_1_1point__storage.html#39da1fa2fc313b6b05e6a63578957e4a">Container</a>.size());
<a name="l00435"></a>00435       const_iterator c;
<a name="l00436"></a>00436       <span class="keywordflow">for</span>(c = src.<a class="code" href="classSimSite3D_1_1point__storage.html#39da1fa2fc313b6b05e6a63578957e4a">Container</a>.begin(); c != src.<a class="code" href="classSimSite3D_1_1point__storage.html#39da1fa2fc313b6b05e6a63578957e4a">Container</a>.end(); ++c)
<a name="l00437"></a>00437         Container.push_back(*c);
<a name="l00438"></a>00438 
<a name="l00439"></a>00439       <span class="comment">//std::copy(src.Container.begin(), src.Container.end(), Container);</span>
<a name="l00440"></a>00440 
<a name="l00441"></a>00441       my_float_t* p = positions.<a class="code" href="classSimSite3D_1_1my__float__array.html#764b70c62326d6ed689ecc3fdce08c5a">begin</a>();
<a name="l00442"></a>00442       <span class="keywordflow">for</span>(iterator s = Container.begin(); 
<a name="l00443"></a>00443           p &lt; positions.<a class="code" href="classSimSite3D_1_1my__float__array.html#62e4444b755858beec023de8d9fceeef">end</a>() &amp;&amp; s != Container.end(); ++s){
<a name="l00444"></a>00444         s-&gt;pos = p;
<a name="l00445"></a>00445         p += positions.<a class="code" href="classSimSite3D_1_1my__float__array.html#ca02b23f8fd6e8a60a28e4cfae8a648e">stride</a>(); 
<a name="l00446"></a>00446       }
<a name="l00447"></a>00447     }
<a name="l00448"></a>00448 
<a name="l00449"></a>00449     <span class="comment">// We are prototyping methods that can make use of an axis aligned</span>
<a name="l00450"></a>00450     <span class="comment">// grid.  In the future, if we want a datastructure that can handle</span>
<a name="l00451"></a>00451     <span class="comment">// global transformations, we could consider spheres centered at</span>
<a name="l00452"></a>00452     <span class="comment">// the center of each grid cell and with a radius of the distance</span>
<a name="l00453"></a>00453     <span class="comment">// from a grid cell center to one of that grid cell's end corners</span>
<a name="l00454"></a>00454     
<a name="l00455"></a>00455     <span class="keywordtype">bool</span> A_has_been_transformed;
<a name="l00456"></a>00456     <a class="code" href="classSimSite3D_1_1point__bins.html">point_bins&lt;const_iterator&gt;</a> A_bins;
<a name="l00457"></a>00457   
<a name="l00458"></a>00458   };
<a name="l00459"></a>00459 
<a name="l00460"></a>00460 }
<a name="l00461"></a>00461 
<a name="l00462"></a>00462 <span class="preprocessor">#endif</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Apr 3 23:09:18 2012 for simsite3d by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
